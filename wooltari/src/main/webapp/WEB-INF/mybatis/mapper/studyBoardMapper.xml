<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="studyBoard">
	<select id="maxNum" resultType="Integer" parameterType="map">
		SELECT NVL(MAX(num), 0) FROM ${tableName}_board
	</select>
	
	<insert id="insertBoard" parameterType="com.wooltari.study.board.Board">
	INSERT INTO ${tableName}_board(num, s_num, userId, content ,imageFileName)
	   VALUES (#{num}, #{s_num}, #{userId}, #{content},#{imageFileName, jdbcType=VARCHAR})
	</insert>
	
	<!-- 글 리스트 -->
	<select id="listBoard" parameterType="Map" resultType="com.wooltari.study.board.Board">
			SELECT * FROM(
			SELECT rownum rnum, tb.* FROM(
				SELECT num, s_num ,content, hitcount, imageFileName, userName,
				created, b.userId
				FROM ${tableName}_board b JOIN member m ON b.userId=m.userId
  			ORDER BY num DESC
  		<![CDATA[	
			)tb WHERE rownum <= #{end}
		)WHERE rnum>=#{start}
		]]>
	</select>
	
	<!-- 글 개수 -->
	<select id="dataCount" parameterType="map" resultType="Integer" >	
		SELECT NVL(COUNT(*),0) FROM ${tableName}_board b
			JOIN member m ON b.userId=m.userId
	</select>
	
	<!-- 글 좋아요 -->
	<insert id="insertLikeBoard" parameterType="map">
		INSERT INTO ${tableName}_boardlike (num,userId) 
			VALUES(#{num},#{userId})
	</insert>
	<!-- 좋아요 갯수 -->
	<select id="countLikeBoard" parameterType="map" resultType="Integer"  >
		SELECT NVL(COUNT(*),0) FROM ${tableName}_boardlike WHERE num=#{num}
	</select>
</mapper>